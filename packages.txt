You are a senior full‑stack engineer working inside our existing AlbGuide repo:

Client: React + Vite (/client)
Server: Node/Express (/server)
old_alb: check old colours and layouts
Database: Supabase Postgres
Storage: Supabase Storage
Auth: Supabase Auth + users.is_admin already exists
Payment: Cash only (pay on arrival / pay after WhatsApp contact)
Your mission: analyze the current project first, then design + implement the Packages + Booking + Reviews + Favorites system using the project’s existing patterns.

1) Analyze the codebase first (required)
Inspect and summarize:

Current DB + Supabase usage patterns (server/config/supabase.js, controllers/models, middleware)
Existing Destinations CRUD + admin pages + how “active/visibility” is currently handled (if it exists)
How client does routing, API calls, auth state, protected admin routes
Output:

Current architecture summary
Where to add: server routes/controllers/models, client pages/components/hooks, Supabase SQL + RLS
Do not reinvent the architecture.

2) Visibility rules (Active-only)
destiantions already support is_active boolean (default false):

Add (or enforce) is_active boolean (default false) for:
packages
Public endpoints/pages must show only is_active = true
Admin can view/manage all, toggle active anytime
3) Packages (Destination has many Packages)
Implement:

One Destination → many Packages
One Package → one Destination
Package content requirements (must be supported in schema + UI)
Each Package must include:

about
description
what_youll_see (admin highlight)
itinerary
whats_included
whats_not_included
what_to_expect
meeting_and_pickup
accessibility
additional_information
cancellation_policy
help
Also propose and add essential fields for a real listing (e.g. duration, price, location/meeting point details, languages, group size, min age), but keep it consistent with the current project.

4) Images (Supabase Storage): official + traveler
Use Supabase Storage to support:

Official package images (admin uploaded)
Traveler/review images (user uploaded with a review)
Requirements:

Package page must show:
Admin images
Traveler images (with username and date)

Enforce:

file type/size limits
upload limits per review
safe storage policies
5) Availability is date-only
Availability is not time-slot based.

Model and implement:

Package has availability by date
Each date has capacity / remaining spots (or a simple “open/closed + max travelers” rule)
Add a concurrency-safe mechanism to prevent overbooking
6) Booking flow (cash payment + WhatsApp required + guest booking allowed)
Bookings must support two modes:

A) Guest booking (no account required)
Anyone can book by providing:

Full name
Date
Travelers:
adults
children
infants (optional)
WhatsApp number with country code (required; validate format)
Optional note/message
Store guest bookings without requiring user_id.

B) Logged-in user booking
If user is logged in:

link booking to user_id
same required fields, including WhatsApp with country code
booking appears in user history
UX requirement: encourage account creation
If user is not logged in, still allow booking, but show a strong, friendly prompt explaining benefits:

booking history tracking
favorites/saved packages
ability to leave reviews after the experience
personalized experience
Payments:

no card integration
treat bookings as “cash / contact via WhatsApp to confirm details”
store booking status (e.g. pending_contact, confirmed, completed, cancelled)
7) Favorites (heart/save) = users only
Favorites require login:

favorites table with unique (user_id, package_id)
API to toggle + list favorites
UI: heart icon and “My Favorites” page
Guests cannot favorite; show CTA to log in/create account
8) Reviews (TripAdvisor-like integrity) = users only, only after verified experience
Rules:

Only logged-in users can review
User can review only if they have a verified booking for that package
Prefer: only after booking is marked completed (or after booking date passes + confirmed), choose one and enforce it
Anti-fake policies to implement:

One review per booking (DB constraint)
Rate limiting / spam controls
Prevent duplicate submissions (idempotency / unique keys)
Reporting/moderation tools (recommended)
Optional moderation state: pending/approved/rejected (decide based on admin needs)
Reviews show on package page + in user account history (“Leave a review” button for eligible completed bookings).

Traveler photos uploaded with reviews:

appear on package gallery
show username attribution
Guests:

cannot leave reviews (must create an account)
9) Supabase RLS + Storage policies (mandatory)
Implement RLS aligned with rules:

Public can read only active destinations/packages
Admin can create/update all, toggle is_active
Bookings:
guest bookings: create allowed without auth (but secured; validate + rate-limit)
user bookings: user can read own
admin can read all
Favorites: user-only
Reviews: create only if eligible + user-only edits (within rule)
Storage policies must match table permissions and ownership.

10) Deliverables
Provide:

DB schema SQL (tables, constraints, indexes, RLS, storage policies)
API spec + route/controller plan (matching current server style)
Client pages/components plan (public + admin + user area)
Admin workflows (packages CRUD, activate/deactivate, availability management, review moderation)
Edge cases checklist (overbooking, guest spam prevention, WhatsApp validation, data privacy)